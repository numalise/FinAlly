# =====================================================================
# FinAlly Environment Variables Template
# =====================================================================
#
# Copy this file to create environment-specific configuration:
#
#   Frontend:  cp .env.example frontend/.env.local
#   Lambda:    Variables set via Terraform (see below)
#
# IMPORTANT: Never commit .env files to version control
#            All .env* files are gitignored except .env.example
#
# Last Updated: December 2025
# =====================================================================

# =====================================================================
# FRONTEND ENVIRONMENT VARIABLES
# =====================================================================
#
# Location: frontend/.env.local
# Used by: Next.js frontend application
#
# All frontend environment variables MUST be prefixed with NEXT_PUBLIC_
# to be accessible in the browser.
#
# How to get these values:
#   cd terraform/environments/dev
#   terraform output
# =====================================================================

# API Gateway URL
# Example: https://z7rz9vksp6.execute-api.eu-central-1.amazonaws.com
# Terraform output: api_invoke_url
NEXT_PUBLIC_API_URL=https://your-api-id.execute-api.your-region.amazonaws.com

# Cognito User Pool ID
# Example: eu-central-1_AbCdEfGhI
# Terraform output: cognito_user_pool_id
NEXT_PUBLIC_COGNITO_USER_POOL_ID=your-region_XXXXXXXXX

# Cognito Web App Client ID
# Example: 1a2b3c4d5e6f7g8h9i0j1k2l3m
# Terraform output: cognito_web_client_id
NEXT_PUBLIC_COGNITO_CLIENT_ID=XXXXXXXXXXXXXXXXXXXXXXXXXX

# Cognito Domain (for OAuth)
# Example: finally-dev
# Terraform output: cognito_domain
NEXT_PUBLIC_COGNITO_DOMAIN=finally-dev

# AWS Region
# Example: eu-central-1
# Must match your Terraform deployment region
NEXT_PUBLIC_COGNITO_REGION=eu-central-1

# =====================================================================
# LAMBDA ENVIRONMENT VARIABLES
# =====================================================================
#
# Location: Set via Terraform (terraform/modules/lambda-api/main.tf)
# Used by: Lambda backend API
#
# These variables are NOT stored in .env files.
# They are configured in Terraform and injected at deployment time.
#
# To update Lambda environment variables:
#   1. Edit terraform/modules/lambda-api/main.tf
#   2. Run: terraform apply
# =====================================================================

# Database Connection String
# Format: postgresql://user:password@host:5432/database?sslmode=require&connection_limit=5
# Constructed from Secrets Manager values in Terraform
# Example: postgresql://finally_admin:PASSWORD@finally-dev-postgres.xxx.eu-central-1.rds.amazonaws.com:5432/finally?sslmode=require
DATABASE_URL=postgresql://user:password@host:5432/database?sslmode=require&connection_limit=5&pool_timeout=10

# Cognito User Pool ID (Backend)
# Same as frontend, used for JWT verification
# Terraform output: cognito_user_pool_id
COGNITO_USER_POOL_ID=your-region_XXXXXXXXX

# Cognito Web App Client ID
# Same as frontend NEXT_PUBLIC_COGNITO_CLIENT_ID
# Terraform output: cognito_web_client_id
COGNITO_WEB_CLIENT_ID=XXXXXXXXXXXXXXXXXXXXXXXXXX

# Cognito Backend Client ID (Optional)
# Used for server-to-server authentication
# Terraform output: cognito_backend_client_id
COGNITO_BACKEND_CLIENT_ID=XXXXXXXXXXXXXXXXXXXXXXXXXX

# Node Environment
# Values: development | production
# Affects Prisma logging, error verbosity, etc.
NODE_ENV=development

# =====================================================================
# AWS CLI CONFIGURATION
# =====================================================================
#
# Location: ~/.aws/config and ~/.aws/credentials
# Used by: AWS CLI, Terraform, deployment scripts
#
# Setup:
#   aws configure
#   AWS Access Key ID: AKIAIOSFODNN7EXAMPLE
#   AWS Secret Access Key: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
#   Default region: eu-central-1
#   Default output format: json
# =====================================================================

# AWS Region (for CLI and Terraform)
AWS_REGION=eu-central-1

# AWS Profile (if using named profiles)
# Example: export AWS_PROFILE=finally-dev
AWS_PROFILE=default

# =====================================================================
# TERRAFORM BACKEND CONFIGURATION
# =====================================================================
#
# Location: terraform/environments/{env}/backend.tf
# Used by: Terraform state management
#
# These are configured in backend.tf, not environment variables
# =====================================================================

# S3 Bucket for Terraform State
# Example: finally-terraform-state-123456789012
# Created by: terraform/backend/main.tf
TF_STATE_BUCKET=finally-terraform-state-XXXXXXXXXXXX

# DynamoDB Table for State Locking
# Example: finally-terraform-locks
# Created by: terraform/backend/main.tf
TF_STATE_LOCK_TABLE=finally-terraform-locks

# Terraform State Key
# Example: dev/terraform.tfstate
TF_STATE_KEY=dev/terraform.tfstate

# =====================================================================
# OPTIONAL ENVIRONMENT VARIABLES
# =====================================================================

# Development Database (Local Testing)
# If running PostgreSQL locally for testing
# Format: postgresql://user:password@localhost:5432/finally_dev
LOCAL_DATABASE_URL=postgresql://postgres:password@localhost:5432/finally_dev

# Frontend Development Port
# Default: 3000
# Override if port is in use: PORT=3001 npm run dev
PORT=3000

# Lambda Local Testing (SAM/LocalStack)
# For local Lambda development (future)
SAM_LOCAL_PORT=3001
LOCALSTACK_ENDPOINT=http://localhost:4566

# Log Level (for debugging)
# Values: debug | info | warn | error
# Frontend: Used by custom logger
# Lambda: Affects Prisma query logging
LOG_LEVEL=info

# =====================================================================
# GETTING TERRAFORM OUTPUTS
# =====================================================================
#
# To retrieve all values needed for .env files:
#
#   cd terraform/environments/dev
#   terraform output
#
# Output example:
#   api_invoke_url           = "https://xxx.execute-api.eu-central-1.amazonaws.com"
#   cognito_user_pool_id     = "eu-central-1_XXXXXXXXX"
#   cognito_web_client_id    = "XXXXXXXXXXXXXXXXXXXXXXXXXX"
#   cognito_backend_client_id = "XXXXXXXXXXXXXXXXXXXXXXXXXX"
#   cognito_domain           = "finally-dev"
#   database_endpoint        = "finally-dev-postgres.xxx.rds.amazonaws.com"
#   database_secret_arn      = "arn:aws:secretsmanager:..."
#
# To get a single output:
#   terraform output -raw api_invoke_url
#
# To export all outputs to file:
#   terraform output > terraform-outputs.txt
#
# =====================================================================

# =====================================================================
# QUICK SETUP COMMANDS
# =====================================================================
#
# 1. Deploy infrastructure (first time):
#    cd terraform/environments/dev
#    terraform init
#    terraform apply
#
# 2. Create frontend/.env.local:
#    cd frontend
#    cp ../.env.example .env.local
#    # Edit .env.local with values from terraform output
#
# 3. Verify API connectivity:
#    curl https://YOUR_API_URL/health
#
# 4. Run frontend:
#    cd frontend
#    npm install
#    npm run dev
#
# 5. Test authentication:
#    cd scripts
#    ./test_api.sh
#
# =====================================================================

# =====================================================================
# SECURITY NOTES
# =====================================================================
#
# ✅ DO:
#   - Keep .env files in .gitignore
#   - Use AWS Secrets Manager for sensitive data
#   - Rotate credentials regularly
#   - Use IAM roles instead of access keys where possible
#   - Restrict CORS origins in production
#   - Enable MFA on AWS accounts
#
# ❌ DON'T:
#   - Commit .env files to git
#   - Share .env files via email/Slack
#   - Use production credentials in development
#   - Hardcode credentials in source code
#   - Use overly permissive IAM policies
#   - Expose database publicly
#
# =====================================================================

# =====================================================================
# TROUBLESHOOTING
# =====================================================================
#
# Environment variables not loading?
#   - Restart Next.js dev server (npm run dev)
#   - Verify file is named .env.local (not .env)
#   - Check for typos in variable names
#   - Ensure NEXT_PUBLIC_ prefix for frontend vars
#
# API connection refused?
#   - Verify API Gateway URL is correct
#   - Check AWS region matches
#   - Ensure API is deployed (terraform apply)
#   - Test with: curl https://YOUR_API_URL/health
#
# Authentication failing?
#   - Verify Cognito User Pool ID and Client ID
#   - Check user exists: aws cognito-idp list-users --user-pool-id ...
#   - Ensure user is CONFIRMED status
#   - Test with: scripts/test_api.sh
#
# Database connection failing?
#   - Lambda must be in same VPC as RDS
#   - Security groups must allow Lambda → RDS on port 5432
#   - DATABASE_URL must include sslmode=require
#   - Check CloudWatch logs: aws logs tail /aws/lambda/finally-dev-api
#
# For more help, see: docs/TROUBLESHOOTING.md
#
# =====================================================================

# =====================================================================
# ENVIRONMENT-SPECIFIC CONFIGURATIONS
# =====================================================================
#
# Development (.env.local):
#   - CORS: Allow all origins (*)
#   - Logging: Debug level
#   - Error messages: Detailed
#   - API: http://localhost:3000
#
# Staging (.env.staging):
#   - CORS: Specific staging domains
#   - Logging: Info level
#   - Error messages: Generic
#   - API: https://staging-api.finally.com
#
# Production (.env.production):
#   - CORS: Production domains only
#   - Logging: Warn/Error only
#   - Error messages: Generic
#   - API: https://api.finally.com
#   - CDN: CloudFront distribution
#   - WAF: Enabled
#
# =====================================================================
